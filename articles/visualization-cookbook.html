<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>TNTP Visualization Cookbook • tntpr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="TNTP Visualization Cookbook">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tntpr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/visualization-cookbook.html">TNTP Visualization Cookbook</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tntp/tntpr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>TNTP Visualization Cookbook</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tntp/tntpr/blob/master/vignettes/visualization-cookbook.Rmd" class="external-link"><code>vignettes/visualization-cookbook.Rmd</code></a></small>
      <div class="d-none name"><code>visualization-cookbook.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="how-to-create-tntp-style-graphics">How to create TNTP style graphics<a class="anchor" aria-label="anchor" href="#how-to-create-tntp-style-graphics"></a>
</h2>
<p>At the TNTP data team, we have developed an R package and an R
cookbook to make the process of creating publication-ready graphics in
our in-house style using R’s ggplot2 library a more reproducible
process, as well as making it easier for people new to R to create
graphics.</p>
<p>We’ll get to how you can put together the various elements of these
graphics, but <strong>let’s get the admin out of the way
first…</strong></p>
<div class="section level3">
<h3 id="install-the-tntpr-package">Install the <code>tntpr</code> package<a class="anchor" aria-label="anchor" href="#install-the-tntpr-package"></a>
</h3>
<p>You can install <code>tntpr</code> from CRAN as follows:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"tntpr"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="load-all-the-libraries-you-need">Load all the libraries you need<a class="anchor" aria-label="anchor" href="#load-all-the-libraries-you-need"></a>
</h3>
<p>A few of the steps in this cookbook - and to create charts in R in
general - require certain packages to be installed and loaded. We will
use the following packages.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># NOTE: We are not simply loading `tidyverse` in this vignette due to how vignettes</span></span>
<span><span class="co"># are built to create the documentation website. In other contexts, however, we</span></span>
<span><span class="co"># would simply use `library(tidyverse)` instead of loading many of the packages individually.</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tntp/tntpr" class="external-link">tntpr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://forcats.tidyverse.org/" class="external-link">forcats</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hrbrmstr/ggalt" class="external-link">ggalt</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/ggridges/" class="external-link">ggridges</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="creating-plots-with-tntp_style">Creating plots with <code>tntp_style()</code><a class="anchor" aria-label="anchor" href="#creating-plots-with-tntp_style"></a>
</h3>
<p>The <code>tntpr</code> package contains the function
<code><a href="../reference/tntp_style.html">tntp_style()</a></code>. It add TNTP’s custom <code>ggplot2</code>
theme to your plots and controls items like fonts, font size, titles and
axis labels, tick marks, gridlines, and the legend. The function ensures
we maintain consistency across the org in the look of our plots. Plus,
the style was created with our design team to ensure the look is
aesthetically pleasing.</p>
<p>The function contains parameters where users can adjust items such as
font, font size, text colors, title and legend position, and whether to
show the legend title, axis title, and grid lines. All parameters have
default values so users do not need to set any of them.</p>
<p>Consult the function’s documentation at <code><a href="../reference/tntp_style.html">?tntp_style</a></code> for
more information on the parameters.</p>
<p>Note that colors for lines in the case of a line chart or bars for a
bar chart, do not come out of the box from the <code><a href="../reference/tntp_style.html">tntp_style()</a></code>
function, but need to be explicitly set in your other standard
<code>ggplot</code> chart functions.</p>
<div class="section level4">
<h4 id="example-with-tntp_style">Example with <code>tntp_style()</code><a class="anchor" aria-label="anchor" href="#example-with-tntp_style"></a>
</h4>
<p>Here is a quick example on using the <code><a href="../reference/tntp_style.html">tntp_style()</a></code>
theme.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># base plot we will reuse in this section</span></span>
<span><span class="va">plt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="va"><a href="https://ggplot2.tidyverse.org/reference/mpg.html" class="external-link">mpg</a></span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">displ</span>, <span class="va">hwy</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Cars with higher displacement\nhave a lower MPG"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Displacement vs. MPG"</span>,</span>
<span>    caption <span class="op">=</span> <span class="st">"Data from ggplot's mpg dataset"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Engine Displ."</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"MPG"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">plt</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/tntp_style.html">tntp_style</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="visualization-cookbook_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="setting-font-family-and-font-sizes">Setting font family and font sizes<a class="anchor" aria-label="anchor" href="#setting-font-family-and-font-sizes"></a>
</h4>
<p>We will highlight two parameters to <code><a href="../reference/tntp_style.html">tntp_style()</a></code> that
can help customize your plot.</p>
<p><em><code>family</code></em></p>
<p>The <code>family</code> parameter lets you set the text font family.
This changes the font family for all items, including plot and axis
titles, legend titles and text, and axis text. The parameter defaults to
‘Halyard Display’, TNTP’s font style, but uses ‘sans’ if ‘Halyard
Display’ is not available. You will receive a warning if your specified
font is not found. You can also specify a separate header font using the
<code>header_family</code> parameter.</p>
<p>You will need to manually import additional fonts, including the
Halyard fonts, using the <code>extrafont</code> package before they are
available to R. Follow these steps to import fonts:</p>
<ol style="list-style-type: decimal">
<li>Download the Halyard Display Fonts in .ttf forms from the Data
Analytics Sharepoint Document Library under the “Fonts” category.</li>
<li>Open the fonts folder on your laptop (Settings -&gt; Personalization
-&gt; Fonts) and drag and drop the Halyard Fonts there to install them
on your computer.</li>
<li>In RStudio, install the <code>extrafont</code> package with
<code>install.packages("extrafont")</code>.</li>
<li>Import fonts into the extrafont database with
<code><a href="https://rdrr.io/pkg/extrafont/man/font_import.html" class="external-link">extrafont::font_import()</a></code>. This only needs to be done once.
The process is long, and can be significantly shortened by only
importing the Halyard fonts using
<code>extrafont::font_import(pattern = "Halyard")</code>.</li>
<li>Register the extra fonts with R using
<code><a href="https://rdrr.io/pkg/extrafont/man/loadfonts.html" class="external-link">extrafont::loadfonts()</a></code>. This needs to be done once each R
session, but will be done automatically when loading the
<code>tntpr</code> library.</li>
</ol>
<p>You can check to see which fonts are available to R with
<code>windowsFonts()</code> on Windows or <code><a href="https://rdrr.io/r/grDevices/quartzFonts.html" class="external-link">quartzFonts()</a></code> on
Mac.</p>
<p><em><code>base_size</code></em></p>
<p>The <code><a href="../reference/tntp_style.html">tntp_style()</a></code> function allows a parameter called
<code>base_size</code> which controls font sizes. The default value is
28 and the recommended minimum is 15. The number represents the plot
title’s font size. Other font sizes, such as subtitles, axis labels and
text, and legend labels and text will also be adjusted based on the
<code>base_size</code> value.</p>
<p>Below are the font sizes when <code>base_size</code> is set to the
default of 28:</p>
<ul>
<li>Plot title: 28</li>
<li>Plot subtitle: 22.4</li>
<li>Caption: 11.2</li>
<li>Axis title: 16.8</li>
<li>Axis text: 16.8</li>
</ul>
</div>
<div class="section level4">
<h4 id="further-customizing-plots-outside-tntp_style">Further customizing plots outside <code>tntp_style()</code><a class="anchor" aria-label="anchor" href="#further-customizing-plots-outside-tntp_style"></a>
</h4>
<p><code><a href="../reference/tntp_style.html">tntp_style()</a></code> adds TNTP’s <code>ggplot2</code> theme to
your plot. Users needing more customization can stack themes by adding
an additional <code><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme()</a></code> layer <strong>after</strong> adding
<code><a href="../reference/tntp_style.html">tntp_style()</a></code>. For example, the following plot sets the font
to ‘sans’ and the font size to 20 in <code><a href="../reference/tntp_style.html">tntp_style()</a></code>. It then
manually changes to subtitle font to ‘serif’ and the subtitle size to 25
in an additional <code><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme()</a></code>. <em>Please don’t use this
combination in a real plot!</em></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plt</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/tntp_style.html">tntp_style</a></span><span class="op">(</span>show_axis_titles <span class="op">=</span> <span class="cn">TRUE</span>, family <span class="op">=</span> <span class="st">"sans"</span>, base_size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.subtitle <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"serif"</span>, size <span class="op">=</span> <span class="fl">25</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="visualization-cookbook_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>You can also add theme elements that do not coincide with a parameter
of <code><a href="../reference/tntp_style.html">tntp_style()</a></code>. For example, here we add a border around
the plot with a theme element.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plt</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/tntp_style.html">tntp_style</a></span><span class="op">(</span>show_axis_titles <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.border <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="visualization-cookbook_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>To see all available settings you can adjust with a theme element,
see the documentation for <code><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">?theme</a></code>.</p>
</div>
</div>
<div class="section level3">
<h3 id="using-tntp-brand-colors">Using TNTP brand colors<a class="anchor" aria-label="anchor" href="#using-tntp-brand-colors"></a>
</h3>
<p>The <code>tntpr</code> package includes functions to allow you to
easily use TNTP brand colors in your visualizations.</p>
<div class="section level4">
<h4 id="colors">Colors<a class="anchor" aria-label="anchor" href="#colors"></a>
</h4>
<p>The primary function you’ll use is <code><a href="../reference/tntp_colors.html">tntp_colors()</a></code>, which
takes in human-friendly color names as arguments and returns a character
vector of the equivalent hex codes:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/tntp_colors.html">tntp_colors</a></span><span class="op">(</span><span class="st">"green"</span>, <span class="st">"mint"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "#317D5C" "#E2EDDC"</span></span></code></pre></div>
<p>A companion function is <code><a href="../reference/tntp_colors.html">show_tntp_colors()</a></code>, which will
make a quick display of the given colors in the plot window.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/tntp_colors.html">show_tntp_colors</a></span><span class="op">(</span><span class="st">"green"</span>, <span class="st">"moss"</span>, <span class="st">"mint"</span><span class="op">)</span></span></code></pre></div>
<p><img src="visualization-cookbook_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>You can also use <code><a href="../reference/tntp_colors.html">show_tntp_colors()</a></code> with no color
arguments to display all available colors and names:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Note: the cex_label parameter is used to adjust the relative font size</span></span>
<span><span class="fu"><a href="../reference/tntp_colors.html">show_tntp_colors</a></span><span class="op">(</span>cex_label <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span></span></code></pre></div>
<p><img src="visualization-cookbook_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="palettes">Palettes<a class="anchor" aria-label="anchor" href="#palettes"></a>
</h4>
<p>Some color palettes are used frequently in visualizations. The
<code><a href="../reference/tntp_palette.html">tntp_palette()</a></code> function allows you to access these
pre-determined palettes more easily:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/tntp_palette.html">tntp_palette</a></span><span class="op">(</span><span class="st">"likert_6"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "#C2A60A" "#F2CF13" "#FDE57B" "#8FB09D" "#317D5C" "#1D4935"</span></span></code></pre></div>
<p>Palettes can be reversed by setting <code>reverse = TRUE</code>, and
can be quickly displayed using the <code><a href="../reference/tntp_palette.html">show_tntp_palette()</a></code>
function:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/tntp_palette.html">show_tntp_palette</a></span><span class="op">(</span><span class="st">"likert_6"</span>, reverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="visualization-cookbook_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>For a list and visualization of all pre-set palettes, run the
function with no arguments:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/tntp_palette.html">show_tntp_palette</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="visualization-cookbook_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<p>The example plots below will show how to incorporate these functions
into your ggplot2 visualizations.</p>
<hr>
</div>
</div>
</div>
<div class="section level2">
<h2 id="example-plots">Example Plots<a class="anchor" aria-label="anchor" href="#example-plots"></a>
</h2>
<p>We will now show examples of plots that we frequently use at TNTP
using a fake data set from the <code>tntpr</code> package. Let’s first
load and clean the data set.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load fake data into global environment</span></span>
<span><span class="co"># remove all salaries of 0</span></span>
<span><span class="va">county_data</span> <span class="op">&lt;-</span> <span class="fu">tntpr</span><span class="fu">::</span><span class="va"><a href="../reference/fake_county.html">fake_county</a></span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">t_salary</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="va">avg_salary</span> <span class="op">&lt;-</span> <span class="va">county_data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">t_salary</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">school_year</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>avg_salary <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">t_salary</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span></span></code></pre></div>
<p>We will lower the font size for all plots to 16.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">base_font_size</span> <span class="op">&lt;-</span> <span class="fl">16</span></span></code></pre></div>
<div class="section level3">
<h3 id="make-a-line-chart">Make a line chart<a class="anchor" aria-label="anchor" href="#make-a-line-chart"></a>
</h3>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Make plot</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">avg_salary</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">school_year</span>, y <span class="op">=</span> <span class="va">avg_salary</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="../reference/tntp_colors.html">tntp_colors</a></span><span class="op">(</span><span class="st">"green"</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/dollar_format.html" class="external-link">dollar</a></span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5000</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title<span class="op">=</span><span class="st">"Average Teacher Salaries"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Teacher salaries remained constant between 2012 and 2015"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/tntp_style.html">tntp_style</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="va">base_font_size</span><span class="op">)</span></span></code></pre></div>
<p><img src="visualization-cookbook_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="make-a-multiple-line-chart">Make a multiple line chart<a class="anchor" aria-label="anchor" href="#make-a-multiple-line-chart"></a>
</h3>
<p>Note that in the multiple line chart, we overwrote
<code>ggplot2</code>’s default color scheme to incorporate TNTP colors.
We pulled the hex codes for the colors we wanted to use with
<code><a href="../reference/tntp_palette.html">tntp_palette()</a></code> and added them to the chart with
<code><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_colour_manual()</a></code>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Prepare data</span></span>
<span><span class="va">school_salary</span> <span class="op">&lt;-</span> <span class="va">county_data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">t_salary</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">school_year</span>, <span class="va">school_name</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>avg_salary <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">t_salary</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create list of school names so we can easily filter data set for the number of schools we want</span></span>
<span><span class="va">school_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">school_salary</span><span class="op">$</span><span class="va">school_name</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># only plot two schools</span></span>
<span><span class="va">line_plot_schools</span> <span class="op">&lt;-</span> <span class="va">school_salary</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">school_name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">school_names</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">line_plot_schools</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">school_year</span>, y <span class="op">=</span> <span class="va">avg_salary</span>, color <span class="op">=</span> <span class="va">school_name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/dollar_format.html" class="external-link">dollar</a></span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5000</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_colour_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="../reference/tntp_palette.html">tntp_palette</a></span><span class="op">(</span><span class="st">"colorful"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title<span class="op">=</span><span class="st">"Average Teacher Salaries"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Teacher salaries remained constant between 2012 and 2015"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/tntp_style.html">tntp_style</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="va">base_font_size</span><span class="op">)</span></span></code></pre></div>
<p><img src="visualization-cookbook_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="make-a-bar-chart">Make a bar chart<a class="anchor" aria-label="anchor" href="#make-a-bar-chart"></a>
</h3>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Prepare data</span></span>
<span><span class="va">bar_df</span> <span class="op">&lt;-</span> <span class="va">school_salary</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">school_year</span> <span class="op">==</span> <span class="fl">2015</span>,</span>
<span>    <span class="va">school_name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">school_names</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># add line breaks for better plotting</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>school_name <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_wrap.html" class="external-link">str_wrap</a></span><span class="op">(</span><span class="va">school_name</span>, <span class="fl">7</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">bar_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">school_name</span>, y <span class="op">=</span> <span class="va">avg_salary</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat<span class="op">=</span><span class="st">"identity"</span>, </span>
<span>           position<span class="op">=</span><span class="st">"identity"</span>, </span>
<span>           fill<span class="op">=</span> <span class="fu"><a href="../reference/tntp_colors.html">tntp_colors</a></span><span class="op">(</span><span class="st">"gold"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/dollar_format.html" class="external-link">dollar</a></span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5000</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title<span class="op">=</span><span class="st">"Acacia had higher average salaries in 2015"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Average teacher salaries in 2015 by school"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/tntp_style.html">tntp_style</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="va">base_font_size</span><span class="op">)</span></span></code></pre></div>
<p><img src="visualization-cookbook_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="make-a-stacked-bar-chart">Make a stacked bar chart<a class="anchor" aria-label="anchor" href="#make-a-stacked-bar-chart"></a>
</h3>
<p>The stacked bar chart uses percentages on the y-axis. Note the
formatting of the y-axis to create the percentages:
<code>scale_y_continuous(labels = scales::percent, limits = c(0,1))</code>.
We set <code>limits = c(0,1)</code> to ensure the y-axis limits run from
0% to 100%. When working with percentages, the axis should (almost)
always run from 0% to 100%. Additionally, in <code><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar()</a></code> we
set <code>stat = "identity"</code>. This tells <code>ggplot2</code> to
plot the data as-is and to not aggregate the data when making the plot.
It is often easier to aggregate data outside of <code>ggplot2</code>,
more transparent, and easier to check. We could have also replaced
<code>geom_bar(stat = "identity", position = "stack")</code> with
<code><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col()</a></code> (no parameters needed) to arrive at the same
plot.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#prepare data</span></span>
<span><span class="va">stacked_df</span> <span class="op">&lt;-</span> <span class="va">county_data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">school_year</span> <span class="op">==</span> <span class="fl">2015</span>,</span>
<span>    <span class="va">school_name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">school_names</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>t_salary_cut <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">t_salary</span>, </span>
<span>                    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2500</span>, <span class="fl">3500</span>, <span class="fl">4500</span>, <span class="fl">10000</span><span class="op">)</span>,</span>
<span>                    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"under $2.5k"</span>, <span class="st">"$2.5k-$3.5k"</span>, <span class="st">"$3.5k-$4.5k"</span>, <span class="st">"$4.5k+"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">school_name</span>, <span class="va">t_salary_cut</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>n_cut_school <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop_last"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    n_cut_salary <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n_cut_school</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    perc_in_each_cut <span class="op">=</span> <span class="va">n_cut_school</span> <span class="op">/</span> <span class="va">n_cut_salary</span></span>
<span>  <span class="op">)</span>  <span class="op">|&gt;</span> </span>
<span>  <span class="co"># add line breaks for better plotting</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>school_name <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_wrap.html" class="external-link">str_wrap</a></span><span class="op">(</span><span class="va">school_name</span>, <span class="fl">7</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#set order of stacks by changing factor levels</span></span>
<span><span class="va">stacked_df</span><span class="op">$</span><span class="va">t_salary_cut</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">stacked_df</span><span class="op">$</span><span class="va">t_salary_cut</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">stacked_df</span><span class="op">$</span><span class="va">t_salary_cut</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">stacked_df</span>, </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">school_name</span>, y <span class="op">=</span> <span class="va">perc_in_each_cut</span>, fill <span class="op">=</span> <span class="va">t_salary_cut</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, position <span class="op">=</span> <span class="st">"stack"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/percent_format.html" class="external-link">percent</a></span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="../reference/tntp_palette.html">tntp_palette</a></span><span class="op">(</span><span class="st">"greens"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Most teachers earn between $2.5K and $4.5K"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Percentage of teachers by salary range"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span>, </span>
<span>        legend.justification <span class="op">=</span> <span class="st">"left"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>reverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/tntp_style.html">tntp_style</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="va">base_font_size</span><span class="op">)</span></span></code></pre></div>
<p><img src="visualization-cookbook_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
<p>This example shows proportions, but you might want to make a stacked
bar chart showing number values instead - this is easy to change!</p>
<p>The value passed to the <code>position</code> argument will determine
if your stacked chart shows proportions or actual values.</p>
<p><code>position = "fill"</code> will draw your stacks as proportions,
and <code>position = "identity"</code> will draw number values.</p>
</div>
<div class="section level3">
<h3 id="make-a-grouped-bar-chart">Make a grouped bar chart<a class="anchor" aria-label="anchor" href="#make-a-grouped-bar-chart"></a>
</h3>
<p>Making a grouped bar chart is very similar to making a bar chart. You
just need to change <code>position = "identity"</code> to
<code>position_dodge2(preserve = "single")</code>.</p>
<p>Note the use of the named vector <code>colors_to_use</code> to
expressly map colors to values. This is a safe way to ensure we are
properly mapping colors to values.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># only plot the lowest and highest earning groups</span></span>
<span><span class="va">earnings_to_keep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">stacked_df</span><span class="op">$</span><span class="va">t_salary_cut</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">1</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># map bar colors to values</span></span>
<span><span class="va">colors_to_use</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tntp_colors.html">tntp_colors</a></span><span class="op">(</span><span class="st">"yellow"</span>, <span class="st">"green"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rlang.r-lib.org/reference/set_names.html" class="external-link">set_names</a></span><span class="op">(</span><span class="va">earnings_to_keep</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dodged_df</span> <span class="op">&lt;-</span> <span class="va">stacked_df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># only plot the lowest and highest earning groups</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">t_salary_cut</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="op">!</span><span class="op">!</span><span class="va">earnings_to_keep</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># switch order of factors so that the lowest earnings plot first</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>t_salary_cut <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">t_salary_cut</span>, levels <span class="op">=</span> <span class="va">earnings_to_keep</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">dodged_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">school_name</span>, y <span class="op">=</span> <span class="va">perc_in_each_cut</span>, fill <span class="op">=</span> <span class="va">t_salary_cut</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge2</a></span><span class="op">(</span>preserve <span class="op">=</span> <span class="st">"single"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/percent_format.html" class="external-link">percent</a></span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">colors_to_use</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"More teachers earn over $4.5k than under $2.5k"</span>,</span>
<span>         subtitle <span class="op">=</span> <span class="st">"Percentage of teachers by salary range"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/tntp_style.html">tntp_style</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="va">base_font_size</span><span class="op">)</span></span></code></pre></div>
<p><img src="visualization-cookbook_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="make-a-scatterplot">Make a scatterplot<a class="anchor" aria-label="anchor" href="#make-a-scatterplot"></a>
</h3>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create data set showing school test scores and average school salaries</span></span>
<span><span class="va">scores_salary</span> <span class="op">&lt;-</span> <span class="va">county_data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">school_name</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span></span>
<span>    avg_test_score <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">sch_ela_avg</span> <span class="op">+</span> <span class="va">sch_math_avg</span>, na.rm<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>    avg_salary <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">t_salary</span>, na.rm <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>    enrollment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">sch_enroll_2015</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>perc_rank_test_score <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/percent_rank.html" class="external-link">percent_rank</a></span><span class="op">(</span><span class="va">avg_test_score</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html" class="external-link">drop_na</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">scores_salary</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">avg_salary</span>, <span class="va">perc_rank_test_score</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="../reference/tntp_colors.html">tntp_colors</a></span><span class="op">(</span><span class="st">"tangerine"</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.9</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Schools with higher salaries do not have higher test scores"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Relationship between school test scores and salaries"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Average school salary"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Percentile rank test score"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/dollar_format.html" class="external-link">dollar</a></span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/percent_format.html" class="external-link">percent</a></span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/tntp_style.html">tntp_style</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="va">base_font_size</span>, show_axis_titles <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="visualization-cookbook_files/figure-html/unnamed-chunk-22-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="make-a-dumbbell-chart">Make a dumbbell chart<a class="anchor" aria-label="anchor" href="#make-a-dumbbell-chart"></a>
</h3>
<p>Another way of showing difference is a dumbbell chart. Note that
<code>geom_dumbell()</code> comes from the <a href="https://yonicd.github.io/ggalt/index.html" class="external-link"><code>ggalt</code></a>
package.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dumbbell_df</span> <span class="op">&lt;-</span> <span class="va">dodged_df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>id_cols <span class="op">=</span> <span class="st">"school_name"</span>, names_from <span class="op">=</span> <span class="st">"t_salary_cut"</span>, values_from <span class="op">=</span> <span class="st">"n_cut_school"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html" class="external-link">where</a></span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span>, <span class="op">~</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/replace_na.html" class="external-link">replace_na</a></span><span class="op">(</span><span class="va">.x</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">dumbbell_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">`under $2.5k`</span>, xend <span class="op">=</span> <span class="va">`$4.5k+`</span>, y <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_reorder.html" class="external-link">fct_reorder</a></span><span class="op">(</span><span class="va">school_name</span>, <span class="va">`under $2.5k`</span><span class="op">)</span><span class="op">)</span>, group <span class="op">=</span> <span class="va">school_names</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggalt/man/geom_dumbbell.html" class="external-link">geom_dumbbell</a></span><span class="op">(</span></span>
<span>    color <span class="op">=</span> <span class="fu"><a href="../reference/tntp_colors.html">tntp_colors</a></span><span class="op">(</span><span class="st">"light_grey"</span><span class="op">)</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">3</span>,</span>
<span>    colour_x <span class="op">=</span> <span class="fu"><a href="../reference/tntp_colors.html">tntp_colors</a></span><span class="op">(</span><span class="st">"gold"</span><span class="op">)</span>,</span>
<span>    colour_xend <span class="op">=</span> <span class="fu"><a href="../reference/tntp_colors.html">tntp_colors</a></span><span class="op">(</span><span class="st">"green"</span><span class="op">)</span>,</span>
<span>    show.legend <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"More teachers earn over $4.5k than under $2.5k"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Number of teachers by salary range"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Number of teachers earnign a given salary"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/tntp_style.html">tntp_style</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="va">base_font_size</span><span class="op">)</span></span></code></pre></div>
<p><img src="visualization-cookbook_files/figure-html/unnamed-chunk-23-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="make-a-histogram">Make a histogram<a class="anchor" aria-label="anchor" href="#make-a-histogram"></a>
</h3>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># number of teachers per school</span></span>
<span><span class="va">number_teachers_school</span> <span class="op">&lt;-</span> <span class="va">county_data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">school_year</span>, <span class="va">school_name</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">number_teachers_school</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">5</span>, colour <span class="op">=</span> <span class="st">"white"</span>, fill <span class="op">=</span> <span class="fu"><a href="../reference/tntp_colors.html">tntp_colors</a></span><span class="op">(</span><span class="st">'navy'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Schools have a wide distribution in the number of teachers"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Total number of teachers per school"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Number of teacher in school"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Count"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/tntp_style.html">tntp_style</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="va">base_font_size</span><span class="op">)</span></span></code></pre></div>
<p><img src="visualization-cookbook_files/figure-html/unnamed-chunk-24-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="making-density-plots">Making density plots<a class="anchor" aria-label="anchor" href="#making-density-plots"></a>
</h3>
<p>The <a href="https://wilkelab.org/ggridges/" class="external-link"><code>ggridges</code></a> package
contains additional plots for plotting distributions using ridgeline
plots.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">county_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t_salary</span>, y <span class="op">=</span> <span class="va">school_year</span>, group <span class="op">=</span> <span class="va">school_year</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">school_year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://wilkelab.org/ggridges/reference/geom_density_ridges.html" class="external-link">geom_density_ridges</a></span><span class="op">(</span>quantile_lines <span class="op">=</span> <span class="cn">TRUE</span>, quantiles <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/dollar_format.html" class="external-link">dollar</a></span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Income distrubutions for teachers has remained constant"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Income distrubution and quantiles for teachers"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/tntp_style.html">tntp_style</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="va">base_font_size</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="../reference/tntp_palette.html">tntp_palette</a></span><span class="op">(</span><span class="st">"colorful"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="visualization-cookbook_files/figure-html/unnamed-chunk-25-1.png" width="700"></p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="working-with-survey-data">Working with survey data<a class="anchor" aria-label="anchor" href="#working-with-survey-data"></a>
</h2>
<p>We often work with survey data at TNTP. Here we will highlight a
couple examples of plotting survey data. We will use the
<code>teacher_survey</code> data set in the <code>tntpr</code> package,
which is a fake teacher survey. Let’s start by loading the data set and
calculating averages.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">teacher_survey</span> <span class="op">&lt;-</span> <span class="fu">tntpr</span><span class="fu">::</span><span class="va"><a href="../reference/teacher_survey.html">teacher_survey</a></span></span>
<span></span>
<span><span class="co"># the y-axis will contain text of an entire survey question</span></span>
<span><span class="co"># we want to place line breaks in this text so plots look better</span></span>
<span><span class="va">axis_line_breaks</span> <span class="op">&lt;-</span> <span class="fl">40</span></span>
<span></span>
<span><span class="co"># scales in HE questions, in order starting with the strongest</span></span>
<span><span class="va">agree_disagree_scale</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Strongly Agree"</span>, <span class="st">"Agree"</span>, <span class="st">"Somewhat Agree"</span>, <span class="st">"Somewhat Disagree"</span>, <span class="st">"Disagree"</span>, <span class="st">"Strongly Disagree"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># put survey into long form and clean up question names</span></span>
<span><span class="va">teacher_survey_he</span> <span class="op">&lt;-</span> <span class="va">teacher_survey</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">timing</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"question"</span>, values_to <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate percentage of responses to each high expectations question</span></span>
<span><span class="va">teacher_survey_he_perc</span> <span class="op">&lt;-</span> <span class="va">teacher_survey_he</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html" class="external-link">drop_na</a></span><span class="op">(</span><span class="st">"response"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># calculate the number of responses for each response option</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">question</span>, <span class="va">response</span>, name <span class="op">=</span> <span class="st">"n_response"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># calculate the number of responses for each question</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">question</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>n_question <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n_response</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># calculate percentages</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    <span class="co"># calculate percentages</span></span>
<span>    percent <span class="op">=</span> <span class="va">n_response</span> <span class="op">/</span> <span class="va">n_question</span>,</span>
<span>    <span class="co"># make a column that is text of the percent for plotting</span></span>
<span>    percent_pretty <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html" class="external-link">percent</a></span><span class="op">(</span><span class="va">percent</span>, accuracy <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate percentage of strongly agree and agree</span></span>
<span><span class="va">teacher_survey_he_perc</span> <span class="op">&lt;-</span> <span class="va">teacher_survey_he_perc</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>scale_strength <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">response</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="op">!</span><span class="op">!</span><span class="va">agree_disagree_scale</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">6</span><span class="op">)</span><span class="op">]</span>, <span class="st">"Strong response"</span>, <span class="st">"Weak response"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">question</span>, <span class="va">scale_strength</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>strong_response_percent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">percent</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    strong_response_percent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">response</span> <span class="op">==</span> <span class="st">"Agree"</span>, <span class="va">strong_response_percent</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>    <span class="co"># create line breaks for questions ,which will make plots look better</span></span>
<span>    question <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_wrap.html" class="external-link">str_wrap</a></span><span class="op">(</span><span class="va">question</span>, <span class="va">axis_line_breaks</span><span class="op">)</span>,</span>
<span>    response <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">response</span>, levels <span class="op">=</span> <span class="va">agree_disagree_scale</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="plot-likert-items---highlights-top-two">Plot likert items - highlights top two<a class="anchor" aria-label="anchor" href="#plot-likert-items---highlights-top-two"></a>
</h3>
<p>The first plot calls out the two highest response values, “Strongly
Agree” and “Agree”. Note that the <code><a href="../reference/tntp_style.html">tntp_style()</a></code> function
does not alter the font size or family of the text within
<code><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text()</a></code> so we set it manually.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">teacher_survey_he_perc</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">percent</span>, <span class="va">question</span>, fill <span class="op">=</span> <span class="va">response</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html" class="external-link">percent</a></span><span class="op">(</span><span class="va">strong_response_percent</span>, accuracy <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, x <span class="op">=</span> <span class="va">strong_response_percent</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"white"</span>, fontface <span class="op">=</span> <span class="st">"bold"</span>, family <span class="op">=</span> <span class="st">"Halyard Display"</span>, size <span class="op">=</span> <span class="fl">5</span>, hjust <span class="op">=</span> <span class="fl">1.05</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/percent_format.html" class="external-link">percent</a></span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="../reference/tntp_palette.html">tntp_palette</a></span><span class="op">(</span><span class="st">"top2_6"</span><span class="op">)</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>nrow<span class="op">=</span><span class="fl">2</span>, byrow<span class="op">=</span><span class="cn">TRUE</span>, reverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>  <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"High Expectations Survey Responses"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/tntp_style.html">tntp_style</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="va">base_font_size</span><span class="op">)</span></span></code></pre></div>
<p><img src="visualization-cookbook_files/figure-html/unnamed-chunk-27-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="plot-likert-items---diverging">Plot likert items - diverging<a class="anchor" aria-label="anchor" href="#plot-likert-items---diverging"></a>
</h3>
<p>Diverging charts have been made much simpler with the introduction of
the <code><a href="../reference/position_diverge.html">position_diverge()</a></code> function in tntpr. In interactive
use, if you have both <code>ggplot2</code> and <code>tntpr</code> loaded
this can be called like other positions using a string:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"diverge"</span><span class="op">)</span></span></code></pre></div>
<p>However for non-interactive code such as examples and books (like
this one), it needs be called using the full function:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">teacher_survey_he_perc</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">percent</span>, y <span class="op">=</span> <span class="va">question</span>, fill <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_rev.html" class="external-link">fct_rev</a></span><span class="op">(</span><span class="va">response</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span>position <span class="op">=</span> <span class="fu"><a href="../reference/position_diverge.html">position_diverge</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span></span>
<span>    values <span class="op">=</span> <span class="fu"><a href="../reference/tntp_palette.html">tntp_palette</a></span><span class="op">(</span><span class="st">"likert_6"</span><span class="op">)</span>, </span>
<span>    drop <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    breaks <span class="op">=</span> <span class="va">agree_disagree_scale</span>,</span>
<span>    labels <span class="op">=</span> <span class="va">agree_disagree_scale</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="fl">1</span>, linewidth <span class="op">=</span> <span class="fl">1.2</span>, alpha <span class="op">=</span> <span class="fl">.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">.25</span><span class="op">)</span>, labels <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html" class="external-link">percent</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"High Expectations Survey Responses"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/tntp_style.html">tntp_style</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="va">base_font_size</span><span class="op">)</span></span></code></pre></div>
<p><img src="visualization-cookbook_files/figure-html/unnamed-chunk-29-1.png" width="700"></p>
<p>Calling as a function also allows for additional customization
through the parameters <code>break_after</code>, <code>fill</code>,
<code>vjust</code>, and <code>reverse</code></p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">teacher_survey_he_perc</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">percent</span>, y <span class="op">=</span> <span class="va">question</span>, fill <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_rev.html" class="external-link">fct_rev</a></span><span class="op">(</span><span class="va">response</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span>position <span class="op">=</span> <span class="fu"><a href="../reference/position_diverge.html">position_diverge</a></span><span class="op">(</span>break_after <span class="op">=</span> <span class="st">"Agree"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">percent</span> <span class="op">&gt;</span> <span class="fl">0.1</span>, <span class="va">percent_pretty</span>, <span class="st">""</span><span class="op">)</span><span class="op">)</span>, </span>
<span>            position <span class="op">=</span> <span class="fu"><a href="../reference/position_diverge.html">position_diverge</a></span><span class="op">(</span>break_after <span class="op">=</span> <span class="st">"Agree"</span>, vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>            family <span class="op">=</span> <span class="st">"Halyard Display"</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span></span>
<span>    values <span class="op">=</span> <span class="fu"><a href="../reference/tntp_palette.html">tntp_palette</a></span><span class="op">(</span><span class="st">"likert_6"</span><span class="op">)</span>, </span>
<span>    drop <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    breaks <span class="op">=</span> <span class="va">agree_disagree_scale</span>,</span>
<span>    labels <span class="op">=</span> <span class="va">agree_disagree_scale</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="fl">1</span>, linewidth <span class="op">=</span> <span class="fl">1.2</span>, alpha <span class="op">=</span> <span class="fl">.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">.25</span><span class="op">)</span>, labels <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html" class="external-link">percent</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"High Expectations Survey Responses"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/tntp_style.html">tntp_style</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="va">base_font_size</span><span class="op">)</span></span></code></pre></div>
<p><img src="visualization-cookbook_files/figure-html/unnamed-chunk-30-1.png" width="700"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Dustin Pashouwer, Sam Firke, Shane Orr, Sam Talcott.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
